import{l as a,W as ce,f as te,O as W,a as ue,i as x,j as de}from"./q-BVGk4Zpa.js";import{p as s,i as C,Q as oe,f as fe,r as re,g as ne,t as we,h as pe,j as U,k as L,s as ve,l as me,m as he}from"./q-Cni7KU0_.js";import{t as Se,i as m,b as B,l as ae,c as F,d as Re,C as _e,e as ye,f as be,D as Ee}from"./q-BrtTncdL.js";import{c as K,m as M,r as Y}from"./q-DObOjdzm.js";const Ue=async(l,p)=>{const I=a[0],v=a[1],c=a[2],_=a[3],{type:f="link",forceReload:y=l===void 0,replaceState:P=!1,scroll:A=!0}=typeof p=="object"?p:{forceReload:p};if(C.navCount++,f==="link"&&c.value.type==="initial"){const n=new URL(window.location.href);c.value.dest=n,_.url=n}const d=c.value.dest,e=l===void 0?d:typeof l=="number"?l:Se(l,_.url);if(s.$cbs$&&(y||typeof e=="number"||!m(e,d)||!B(e,d))){const n=C.navCount,k=await Promise.all([...s.$cbs$.values()].map(O=>O(e)));if(n!==C.navCount||k.some(Boolean)){n===C.navCount&&f==="popstate"&&history.pushState(null,"",d);return}}if(typeof e=="number"){history.go(e);return}if(!B(e,d)){location.href=e.href;return}if(!y&&m(e,d)){{f==="link"&&e.href!==location.href&&history.pushState(null,"",e);let n=document.getElementById(oe);n||(n=document.getElementById(fe)),n||(n=document.documentElement),re(f,e,new URL(location.href),n,ne()),f==="popstate"&&(window._qRouterScrollEnabled=!0)}return}return c.value={type:f,dest:e,forceReload:y,replaceState:P,scroll:A},ae(e),F(Y,M,K,e.pathname),I.value=void 0,_.isNavigating=!0,new Promise(n=>{v.r=n})},Ce=we,De=({track:l})=>{const p=a[0],I=a[1],v=a[2],c=a[3];a[4];const _=a[5],f=a[6],y=a[7],P=a[8],A=a[9],d=a[10],e=a[11],n=a[12],k=a[13];async function O(){const h=l(d),z=l(p),le=ce(""),S=e.url,w=z?"form":h.type,ie=h.replaceState;let o,H,N=null,j;{o=new URL(h.dest,location),o.pathname.endsWith("/")||(o.pathname+="/");let D=F(Y,M,K,o.pathname);j=te();const b=H=await ae(o,{action:z,clearCache:!0});if(!b){d.untrackedValue={type:w,dest:o};return}const T=b.href,$=new URL(T,o);m($,o)||(b.isRewrite||(o=$),D=F(Y,M,K,$.pathname));try{N=await D}catch(E){console.error(E),window.location.href=T;return}}if(N){const[D,b,T,$]=N,E=T,se=E[E.length-1];h.dest.search&&m(o,S)&&(o.search=h.dest.search);let G=!1,J=!1,Z=!1;m(o,S)||(W(e,"prevUrl")&&(G=!0),n.prevUrl=S),n.url!==o&&(W(e,"url")&&(J=!0),n.url=o),n.params!==b&&(W(e,"params")&&(Z=!0),n.params=b),d.untrackedValue={type:w,dest:o};const g=pe(H,e,E,le,k);I.headings=se.headings,I.menu=$,v.untrackedValue=ue(E),c.links=g.links,c.meta=g.meta,c.styles=g.styles,c.scripts=g.scripts,c.title=g.title,c.frontmatter=g.frontmatter;{let X;w==="popstate"&&(X=ne());const R=document.getElementById(oe)??document.documentElement;(h.scroll&&(!h.forceReload||!m(o,S))&&(w==="link"||w==="popstate")||w==="form"&&!m(o,S))&&(document.__q_scroll_restore__=()=>re(w,o,S,R,X));const ee=H?.loaders;if(ee){const r=te();for(const[u,q]of Object.entries(ee)){const t=f[u],i=await q;y[u]=i,t?t.invalidate():f[u]=Re(y,u,o,Ee,r)}}if(_e.clear(),!window._qRouterSPA){if(window._qRouterSPA=!0,history.scrollRestoration="manual",window.addEventListener("popstate",()=>{window._qRouterScrollEnabled=!1,clearTimeout(window._qRouterScrollDebounce),_(location.href,{type:"popstate"})}),window.removeEventListener("popstate",window._qRouterInitPopstate),window._qRouterInitPopstate=void 0,!window._qRouterHistoryPatch){window._qRouterHistoryPatch=!0;const r=history.pushState,u=history.replaceState,q=t=>(t===null||typeof t>"u"?t={}:t?.constructor!==Object&&(t={_data:t}),t._qRouterScroll=t._qRouterScroll||L(R),t);history.pushState=(t,i,Q)=>(t=q(t),r.call(history,t,i,Q)),history.replaceState=(t,i,Q)=>(t=q(t),u.call(history,t,i,Q))}document.addEventListener("click",r=>{if(r.defaultPrevented)return;const u=r.target.closest("a[href]");if(u&&!u.hasAttribute("preventdefault:click")){const q=u.getAttribute("href"),t=new URL(location.href),i=new URL(q,t);if(B(i,t)&&m(i,t)){if(r.preventDefault(),!i.hash&&!i.href.endsWith("#")){i.href!==t.href&&history.pushState(null,"",i),window._qRouterScrollEnabled=!1,clearTimeout(window._qRouterScrollDebounce),U({...L(R),x:0,y:0}),location.reload();return}_(u.getAttribute("href"))}}}),document.removeEventListener("click",window._qRouterInitAnchors),window._qRouterInitAnchors=void 0,window.navigation||(document.addEventListener("visibilitychange",()=>{if((window._qRouterScrollEnabled||window._qCityScrollEnabled)&&document.visibilityState==="hidden"){window._qCityScrollEnabled&&console.warn('"_qCityScrollEnabled" is deprecated. Use "_qRouterScrollEnabled" instead.');const r=L(R);U(r)}},{passive:!0}),document.removeEventListener("visibilitychange",window._qRouterInitVisibility),window._qRouterInitVisibility=void 0),window.addEventListener("scroll",()=>{!window._qRouterScrollEnabled&&!window._qCityScrollEnabled||(clearTimeout(window._qRouterScrollDebounce),window._qRouterScrollDebounce=setTimeout(()=>{const r=L(R);U(r),window._qRouterScrollDebounce=void 0},200))},{passive:!0}),removeEventListener("scroll",window._qRouterInitScroll),window._qRouterInitScroll=void 0,ve.resolve()}if(w!=="popstate"){window._qRouterScrollEnabled=!1,clearTimeout(window._qRouterScrollDebounce);const r=L(R);U(r)}const V=()=>(be(window,w,S,o,ie),v.force(),de(j));(()=>{if(A?.viewTransition===!1)return V();{const r=he({update:V,types:["qwik-navigation"]});return r?r.ready:Promise.resolve()}})().catch(r=>{throw V(),r}).finally(()=>{j.element.setAttribute?.(ye,D);const r=L(R);U(r),window._qRouterScrollEnabled=!0,me(),G&&x(e,"prevUrl"),J&&x(e,"url"),Z&&x(e,"params"),e.isNavigating=!1,P.r?.()})}}}O()},Te=l=>(s.$handler$||=p=>{if(C.navCount++,!s.$cbs$)return;[...s.$cbs$.values()].map(v=>v.resolved?v.resolved():v()).some(Boolean)&&(p.preventDefault(),p.returnValue=!0)},(s.$cbs$||=new Set).add(l),l.resolve(),window.addEventListener("beforeunload",s.$handler$),()=>{s.$cbs$&&(s.$cbs$.delete(l),s.$cbs$.size||(s.$cbs$=void 0,window.removeEventListener("beforeunload",s.$handler$)))});export{Te as s_LDcpesjcjsM,Ce as s_OWDvw0JhwHs,De as s_QmtAUaKL0K0,Ue as s_mP0Qwvt2uxQ};
